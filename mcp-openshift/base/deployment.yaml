---
kind: Deployment
apiVersion: apps/v1
metadata:
  name: ocp-mcp-server
  labels:
    app: ocp-mcp-server
spec:
  selector:
    matchLabels:
      app: ocp-mcp-server
  replicas: 1
  template:
    metadata:
      labels:
        app: ocp-mcp-server
        deployment: ocp-mcp-server
    spec:
      serviceAccountName: ocp-mcp
      containers:
      - name: ocp-mcp-server
        image: quay.io/sudash/kubernetes-mcp-server:v0.0.53-config  # Built from source with --config support
        imagePullPolicy: Always
        ports:
          - name: http
            containerPort: 8000
            protocol: TCP
        command: ["./kubernetes-mcp-server"]
        args: 
          - "--config"
          - "/etc/mcp-server/config.toml"
        volumeMounts:
        - name: mcp-config
          mountPath: /etc/mcp-server
          readOnly: true
        - name: keycloak-oidc-ca
          mountPath: /etc/pki/keycloak-ca
          readOnly: true
        resources: {}
      volumes:
      - name: mcp-config
        configMap:
          name: ocp-mcp-server-config
      - name: keycloak-oidc-ca
        configMap:
          name: keycloak-oidc-ca
